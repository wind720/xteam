<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Homepage</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="flickity/flickity.css" media="screen">
</head>

<body>
    <div class="header">
        <div class="headertitle"><img src="images/console-controller.1024x1024.png" class="icon" alt="icon"> Xteam</div>
        <div class="oh">
            <div><a href=""><img src="images/pngegg.png" alt="shopping cart" class="cart"></a></div>
            <div>|</div>
            <div id="userLink"><img src="images/‚ÄîPngtree‚Äîuser icon_4479727.png" alt="user" class="cart"></div>
            <div class="us" id="loggedInUser">Sem usu√°rio</div>
        </div>
        
    </div>
    <main>
        <div class="destaque">
            <div class="pop">MAIS POPULARES
            <div class="p">CONFIRA OS JOGOS DO MOMENTO</div></div>
            <div class="gallery js-flickity" data-flickity-options='{ "freeScroll": true, "wrapAround": true }'>
                <div class="gallery-cell1"></div>
                <div class="gallery-cell2"></div>
                <div class="gallery-cell3"></div>
            </div>
        </div>
        <div class="form-container">
            <form class="search-bar">
                <label for="search-input"></label>
                <input type="text" id="search-input" placeholder="üîç Digite o nome do jogo">
            </form>
        </div>
        <div class="games">
        <section class="produto1" id="Lethal Company">
            <button>Comprar</button>
        </section>

        <section class="produto2" id="Fortnite">
            <button>Comprar</button>
        </section>

        <section class="produto3" id="Lies of P">
            <button>Comprar</button>
        </section>

        <section class="produto4" id="Celest">
            <button>Comprar</button>
        </section>

        <section class="produto5" id="Diablo IV">
            <button>Comprar</button>
        </section>

        <section class="produto6" id="Guacamelee! 2">
            <button>Comprar</button>
        </section>

        <section class="produto7" id="Five Nights At Freddy's: Security Breach">
            <button>Comprar</button>
        </section>

        <section class="produto8" id="Valorant">
            <button>Comprar</button>
        </section>

        <section class="produto9" id="Overwatch 2">
            <button>Comprar</button>
        </section>

        <section class="produto10" id="Dark Deception">
            <button>Comprar</button>
        </section>

        <section class="produto11" id="Rayman Legends">
            <button>Comprar</button>
        </section>

        <section class="produto12" id="Elden Ring">
            <button>Comprar</button>
        </section>
    </div>
    <div class="games hidden">
        <section class="produto1" id="Lethal Company">
            <button>Comprar</button>
        </section>

        <section class="produto2" id="Fortnite">
            <button>Comprar</button>
        </section>

        <section class="produto3" id="Lies of P">
            <button>Comprar</button>
        </section>

        <section class="produto4" id="Celest">
            <button>Comprar</button>
        </section>
    </div>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    // Fun√ß√£o para exibir o prompt de login ou cadastro
    function showLoginOrRegisterPrompt() {
        const action = prompt('Deseja fazer login ou cadastro? (Digite "login" ou "cadastro")').toLowerCase();

        if (action === 'login') {
            // Se a a√ß√£o for login, continue com a fun√ß√£o existente de login
            login();
        } else if (action === 'cadastro') {
            // Se a a√ß√£o for cadastro, chame a fun√ß√£o de cadastro
            register();
        } else {
            // Se a entrada for inv√°lida, exiba uma mensagem de erro e pe√ßa novamente
            alert('Op√ß√£o inv√°lida. Tente novamente.');
            showLoginOrRegisterPrompt();
        }
    }

    var searchInput = document.getElementById("search-input");
            searchInput.addEventListener("input", function () {
                var searchTerm = searchInput.value.toLowerCase();
        
                // Considera todas as se√ß√µes de jogos
                var sections = document.querySelectorAll('.games section');
        
                var visibleSections = Array.from(sections).filter(function (section) {
                    var sectionId = section.id.toLowerCase();
                    return sectionId.includes(searchTerm);
                });
        
                sections.forEach(function (section) {
                    section.style.opacity = "0";
                    section.style.transform = "translateY(-50px)";
                    section.style.position = "absolute";
                });
        
                visibleSections.forEach(function (section, index) {
                    section.style.opacity = "1";
                    section.style.transform = "translateY(0)";
                    section.style.position = "static";
                    section.style.transitionDelay = index * 0.1 + "s";
                });
            });

    // Fun√ß√£o para realizar o login
    function login() {
        const username = prompt('Usu√°rio:');
        const password = prompt('Senha:');

        // Fazer uma requisi√ß√£o ao servidor para fazer login
        fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })
        .then(response => {
            if (response.ok) {
                alert('Login bem-sucedido!');
                location.reload(); // Recarregar a p√°gina ap√≥s o login
            } else {
                alert('Credenciais inv√°lidas. Tente novamente.');
                showLoginOrRegisterPrompt();
            }
        })
        .catch(error => {
            console.error('Erro ao fazer login:', error);
        });
    }

    // Fun√ß√£o para realizar o cadastro
    function register() {
        const newUsername = prompt('Nome de usu√°rio:');
        const newEmail = prompt('Email (no formato nomedoemail@gmail.com):');
        const newPassword = prompt('Senha (m√≠nimo  caracteres, incluindo um n√∫mero e um caractere especial):');

        // Validar as entradas
        if (!isValidEmail(newEmail) || !isValidPassword(newPassword) || !isValidUsername(newUsername)) {
            alert('Entradas inv√°lidas. Tente novamente.');
            showLoginOrRegisterPrompt();
            return;
        }

        // Fazer uma requisi√ß√£o ao servidor para cadastrar o novo usu√°rio
        fetch('/cadastrarUsuario', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username: newUsername, email: newEmail, password: newPassword })
        })
        .then(response => {
            if (response.ok) {
                alert('Cadastro bem-sucedido!');
            } else {
                alert('Erro ao cadastrar usu√°rio. Tente novamente.');
            }
        })
        .catch(error => {
            console.error('Erro ao cadastrar usu√°rio:', error);
        });
    }

    // Fun√ß√£o para validar o formato do email
    function isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    // Fun√ß√£o para validar o formato da senha
    function isValidPassword(password) {
        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
        return passwordRegex.test(password);
    }

    // Fun√ß√£o para validar o formato do nome de usu√°rio
    function isValidUsername(username) {
        return username.length <= 30;
    }

    // Atualizar informa√ß√µes do usu√°rio ao carregar a p√°gina
    fetch('/check-login')
    .then(response => {
        console.log('Response:', response);
        return response.json();
    })
        .then(data => {
            const isLoggedIn = data.isLoggedIn;

            if (isLoggedIn) {
                // Se o usu√°rio estiver logado, atualize a div com o nome de usu√°rio
                document.getElementById('loggedInUser').textContent = data.username;
            } else {
                // Se o usu√°rio n√£o estiver logado, exiba o prompt para login ou cadastro
                showLoginOrRegisterPrompt();
            }
        })
        .catch(error => {
            console.error('Erro ao verificar o status de login:', error);
        });

    // Adicionar evento de clique ao link de usu√°rio
    document.getElementById('userLink').addEventListener('click', () => {
        // Verificar se o usu√°rio est√° logado antes de redirecionar para a p√°gina de personaliza√ß√£o
        fetch('/check-login')
            .then(response => response.json())
            .then(data => {
                const isLoggedIn = data.isLoggedIn;

                if (isLoggedIn) {
                    // Se o usu√°rio estiver logado, redirecione para a p√°gina de personaliza√ß√£o do usu√°rio
                    window.location.href = '/personalizacaoUsuario/personalizacaoUsuario.html';
                } else {
                    // Se o usu√°rio n√£o estiver logado, exiba o prompt para login ou cadastro
                    showLoginOrRegisterPrompt();
                }
            })
            .catch(error => {
                console.error('Erro ao verificar o status de login:', error);
            });
    });
});
    </script>
</main>
<script src="flickity/flickity.pkgd.min.js"></script>
        
</body>

</html>